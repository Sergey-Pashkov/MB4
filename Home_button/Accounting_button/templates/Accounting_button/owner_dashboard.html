{% extends "Accounting_button/base.html" %}
{% load static %}

{% block title %}Owner Dashboard{% endblock %}

{% block content %}
<h1>Owner Dashboard</h1>
<p>Welcome, {{ user.username }}!</p>

<h2>Создание нового пользователя</h2>
<form method="post">
    {% csrf_token %}
    {{ form_user.as_p }}
    <button type="submit" name="create_user" class="btn btn-primary">Create User</button>
</form>

<h2>Редактирование констант</h2>
{% for constant, form_constant in constants_forms %}
    <form method="post" class="mb-3">
        {% csrf_token %}
        <input type="hidden" name="constant_id" value="{{ constant.id }}">
        <div class="form-group">
            <label>{{ constant.name }}</label>
            {{ form_constant.value }}
            {{ form_constant.comment }}
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="edit_mode_{{ constant.id }}" onchange="toggleEditMode({{ constant.id }})">
                <label class="form-check-label" for="edit_mode_{{ constant.id }}">Редактировать</label>
            </div>
        </div>
        {% if constant.name != "Накладные расходы на 1 час фонда рабочего времени (руб.)" %}
        <button type="submit" class="btn btn-primary">Save</button>
        {% endif %}
    </form>
{% endfor %}
{% endblock %}

{% block extra_js %}
<script>
function toggleEditMode(constantId) {
    const isChecked = document.getElementById('edit_mode_' + constantId).checked;
    const valueField = document.getElementById('id_value_' + constantId);
    const commentField = document.getElementById('id_comment_' + constantId);

    if (isChecked) {
        valueField.removeAttribute('readonly');
        commentField.removeAttribute('readonly');
    } else {
        valueField.setAttribute('readonly', 'readonly');
        commentField.setAttribute('readonly', 'readonly');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.form-check-input').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            const constantId = this.id.split('_')[2];
            toggleEditMode(constantId);
        });
    });

    // Initial setup to make fields readonly
    document.querySelectorAll('input[id^="id_value_"], textarea[id^="id_comment_"]').forEach(function(field) {
        field.setAttribute('readonly', 'readonly');
    });
});
</script>
{% endblock %}
